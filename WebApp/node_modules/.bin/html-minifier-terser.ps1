#!/usr/bin/env pwsh

$scriptDir = Split-Path $MyInvocation.MyCommand.Definition -Parent
$nodeExe = if ($PSVersionTable.PSVersion -lt "6.0" -or $IsWindows) { ".exe" } else { "" }
$ret = 0

$nodePath = "$scriptDir/node$nodeExe"
if (Test-Path $nodePath) {
    $args = @(
        "$scriptDir/../html-minifier-terser/cli.js"
        $args
    )

    # Support pipeline input
    if ($MyInvocation.ExpectingInput) {
        $input | & $nodePath @args
    } else {
        & $nodePath @args
    }

    $ret = $LASTEXITCODE
} else {
    Write-Error "Node.js executable not found at '$nodePath'"
    $ret = 1
}

exit $ret
