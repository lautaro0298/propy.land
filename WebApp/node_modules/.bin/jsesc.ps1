#!/usr/bin/env pwsh

$scriptDir = Split-Path $MyInvocation.MyCommand.Definition -Parent

# Set the executable based on the PSVersion and OS
$exe = if ($PSVersionTable.PSVersion -lt "6.0" -or $IsWindows) { ".exe" } else { "" }

# Set the path to the jsesc executable
$jsEscPath = Join-Path $scriptDir "../jsesc/bin/jsesc$exe"

# Check if the jsesc executable exists
if (Test-Path $jsEscPath) {
    # Support pipeline input
    if ($MyInvocation.ExpectingInput) {
        $input | & $jsEscPath $args
    } else {
        & $jsEscPath $args
    }
    $ret = $LASTEXITCODE
} else {
    Write-Error "jsesc executable not found at $jsEscPath"
    $ret = 1
}

exit $ret
